<app-page-header [title]="'Quality Analysis'" [activeTitle]="'Home'" [title1]="'Quality Analysis'"></app-page-header>

<div class="grid grid-cols-12 gap-x-6">
  <div class="xl:col-span-12 col-span-12">
    <div class="">
      @if(dataServices.qualityAnalysisPostLoading$ | async){
      <div class="ti-spinner text-primary p-2 m-2" role="status">
        <span class="sr-only">Loading...</span>
      </div>
      }@else {
      @if (this.qualityAnalysis.status != "no_data"){
      <button type="button" class="ti-btn ti-btn-primary-full !py-1 !px-2 ti-btn-wave m-2"
        (click)="generatePDF2()">Export Quality Analysis</button>

      <div class="box mt-4">
        <div class="box-header">
          <h5 class="box-title">Quality Analysis</h5>
        </div>
        <div class="box-body">

          <div class="table-responsive m-2 !mt-0 !mb-[0rem]">
            <table class="table whitespace-nowrap table-borderless !text-[#8c9097] dark:text-white/50">
              <tbody>
                <tr class="text-start">
                  <th scope="row">
                    <div class="grid grid-cols-3 gap-4">
                      <div class="sm:flex">
                        <div class="form-label">Delta TGF Score</div>
                        <div class="mx-4">{{ this.qualityAnalysis.g_t_score }}</div>
                      </div>
                      <div class="sm:flex">
                        <div class="form-label">Delta W(t) Score</div>
                        <div class="mx-4">{{this.qualityAnalysis.w_t_score}}</div>
                      </div>
                      <div class="sm:flex">
                        <div class="form-label">Erh</div>
                        @if(this.wellInfo.well_info_id==0){
                        <div class="ti-spinner text-primary mx-4" role="status">
                          <span class="sr-only">Loading...</span>
                        </div>
                        }@else if(this.wellInfo.well_info_id==-1){
                        <div class="mx-4">No data.</div>
                        }@else{
                        <div class="mx-4">{{ this.wellInfo.w_t }}</div>
                        }

                      </div>
                    </div>
                  </th>
                </tr>
                <tr class="text-start">
                  <th scope="row">
                    <div class="grid grid-cols-3 gap-4">
                      <div class="sm:flex">
                        <div class="form-label">Delta TGF %</div>
                        <div class="mx-4">{{ this.qualityAnalysis.g_t_percentage }}</div>
                      </div>
                      <div class="sm:flex">
                        <div class="form-label">Delta W(t) %</div>
                        <div class="mx-4">{{this.qualityAnalysis.w_t_percentage}}</div>
                      </div>
                      <div class="sm:flex">
                        <div class="form-label">Gi</div>
                        @if(this.wellInfo.well_info_id==0){
                        <div class="ti-spinner text-primary mx-4" role="status">
                          <span class="sr-only">Loading...</span>
                        </div>
                        }@else if(this.wellInfo.well_info_id==-1){
                        <div class="mx-4">No data.</div>
                        }@else{
                        <div class="mx-4">{{ this.wellInfo.g_t+' °S' }}</div>
                        }

                      </div>
                    </div>
                  </th>
                </tr>
              </tbody>
            </table>
          </div>
          <!-- whitespace-nowrap -->
          <div class="table-responsive m-2 !mt-0 !mb-[0rem]" id="qualityAnalysisPdf">
            <table class="table !p-0 !pt-4 !text-center min-w-full">
              <thead class="">
                <tr class=" table-primary border-b border-defaultborder">
                  <th scope="col " class="!text-center">Survey<br>Stations</th>
                  <th scope="col" class="!text-center">Measure<br>Depth</th>
                  <th scope="col" class="!text-center">Inc</th>
                  <th scope="col" class="!text-center">Azimuth</th>
                  <th scope="col" class="!text-center">G(t)</th>
                  <th scope="col" class="!text-center">ΔTGF</th>
                  <th scope="col" class="!text-center">ΔTGF Comp</th>
                  <th scope="col" class="!text-center">W(t)</th>
                  <th scope="col" class="!text-center">ΔW(t)</th>
                  <th scope="col" class="!text-center">ΔW(t) Comp</th>
                  <th scope="col" class="!text-center">Status</th>
                  <th scope="col" class="!text-center"></th>
                </tr>
              </thead>
              <tbody *ngIf=" !(surveyDataServices.qualityAnalysisPostLoading$ | async);  else loadedContent">

                @if(surveyDataServices.surveyCalculationDetailsPostLoading$ |async){
                <div class="ti-spinner text-primary p-2 m-2" role="status">
                  <span class="sr-only">Loading...</span>
                </div>
                }@else{

                @if(surveyDataServices.surveyCalculationDetailsError$ | async){
                <!-- Show Delete Button -->

                @for(result of this.qualityAnalysis.results; track $index){
                <tr class="border-b border-defaultborder ">
                  <td class="!p-1 !text-center">{{result.id - this.qualityAnalysis.results[0].id + 1}}</td>
                  <td class="!p-1 !text-center">{{result.depth}}</td>
                  <td class="!p-1 !text-center">{{result.Inc}}</td>
                  <td class="!p-1 !text-center">{{result.AzG}}</td>
                  <td class="!p-1 !text-center">{{result.g_t}}</td>
                  <td class="!p-1 !text-center">{{result.g_t_difference}}</td>
                  <td class="{{result.g_t_status | statusColor}} !p-1 !text-center">{{result.g_t_status | uppercase}}
                  </td>
                  <td class="!p-1 !text-center">{{result.w_t}}</td>
                  <td class="!p-1 !text-center">{{result.w_t_difference}}</td>
                  <td class="{{result.w_t_status | statusColor}} !p-1 !text-center">{{result.w_t_status | uppercase}}
                  </td>
                  <td class="{{result.status | statusColor}} !p-1 !text-center">{{result.status | uppercase}}</td>
                  <td class="!p-1 !text-center">



                    @if(this.clickedbutton == result.id){

                    @if(!(this.surveyDataServices.stationDeleteLoading$ | async)){
                    <div class="ti-btn-full ti-btn-outline-danger m-0 rounded-full ti-btn-wave"
                      (click)="deleteSurveyStation(result.id)">
                      <i class="ri-delete-bin-line !py-1 !px-0.5"></i>
                    </div>
                    }@else{

                    <div class="ti-btn-disabled ti-btn-outline-danger m-0 rounded-full ti-btn-wave">
                      <i class="ri-refresh-line !py-1 !px-0.5 animate-spin"></i>
                    </div>
                    }

                    }@else{
                    @if(!(this.surveyDataServices.stationDeleteLoading$ | async)){


                    <div class="ti-btn-full ti-btn-outline-danger m-0 rounded-full ti-btn-wave"
                      (click)="deleteSurveyStation(result.id)">
                      <i class="ri-delete-bin-line !py-1 !px-0.5"></i>
                    </div>

                    }@else{

                    <div
                      class="ti-btn-full ti-btn-outline-danger m-0 rounded-full ti-btn-disabled !cursor-not-allowed !opacity-50">
                      <i class="ri-delete-bin-line !py-1 !px-0.5"></i>
                    </div>

                    }
                    }




                  </td>
                </tr>
                }

                }@else{
                <!-- Do not Show Delete Button -->

                @for(result of this.qualityAnalysis.results; track $index){
                <tr class="border-b border-defaultborder ">
                  <td class="!p-1 !text-center">{{result.id - this.qualityAnalysis.results[0].id + 1}}</td>
                  <td class="!p-1 !text-center">{{result.depth}}</td>
                  <td class="!p-1 !text-center">{{result.Inc}}</td>
                  <td class="!p-1 !text-center">{{result.AzG}}</td>
                  <td class="!p-1 !text-center">{{result.g_t}}</td>
                  <td class="!p-1 !text-center">{{result.g_t_difference}}</td>
                  <td class="{{result.g_t_status | statusColor}} !p-1 !text-center">{{result.g_t_status | uppercase}}
                  </td>
                  <td class="!p-1 !text-center">{{result.w_t}}</td>
                  <td class="!p-1 !text-center">{{result.w_t_difference}}</td>
                  <td class="{{result.w_t_status | statusColor}} !p-1 !text-center">{{result.w_t_status | uppercase}}
                  </td>
                  <td class="{{result.status | statusColor}} !p-1 !text-center">{{result.status | uppercase}}</td>
                  <td></td>
                  <!-- <td class="!p-1 !text-center">



                    @if(this.clickedbutton == result.id){

                    @if(!(this.surveyDataServices.stationDeleteLoading$ | async)){
                    <div class="ti-btn-full ti-btn-outline-danger m-0 rounded-full ti-btn-wave"
                      (click)="deleteSurveyStation(result.id)">
                      <i class="ri-delete-bin-line !py-1 !px-0.5"></i>
                    </div>
                    }@else{

                    <div class="ti-btn-disabled ti-btn-outline-danger m-0 rounded-full ti-btn-wave">
                      <i class="ri-refresh-line !py-1 !px-0.5 animate-spin"></i>
                    </div>
                    }

                    }@else{
                    @if(!(this.surveyDataServices.stationDeleteLoading$ | async)){


                    <div class="ti-btn-full ti-btn-outline-danger m-0 rounded-full ti-btn-wave"
                      (click)="deleteSurveyStation(result.id)">
                      <i class="ri-delete-bin-line !py-1 !px-0.5"></i>
                    </div>

                    }@else{

                    <div
                      class="ti-btn-full ti-btn-outline-danger m-0 rounded-full ti-btn-disabled !cursor-not-allowed !opacity-50">
                      <i class="ri-delete-bin-line !py-1 !px-0.5"></i>
                    </div>

                    }
                    }




                  </td> -->
                </tr>
               }
                }
                }


              </tbody>
              <ng-template #loadedContent>
                <div class="ti-spinner text-primary p-2 m-2" role="status">
                  <span class="sr-only">Loading...</span>
                </div>
              </ng-template>

            </table>
          </div>

        </div>

      </div>
      }@else{
      <div class="">
        <div class="box">
          <div class="box-header">
            <h5 class="box-title">No File Imported</h5>
          </div>
          <div class="m-4">
            <label class="block">
              <span class="sr-only">Choose Survey File</span>
              <input type="file" class="block w-full border border-gray-200 focus:shadow-sm dark:focus:shadow-white/10 rounded-sm text-sm focus:z-10 focus:outline-0 focus:border-gray-200 dark:focus:border-white/10 dark:border-white/10 dark:text-[#8c9097] dark:text-white/50
                      file:me-4 file:py-2 file:px-4
                      file:rounded-s-sm file:border-0
                      file:text-sm file:font-semibold
                      file:bg-primary file:text-white
                      hover:file:bg-primary focus-visible:outline-none
                    " accept=".xlsx, .xls" (change)="onFileSelected($event)">
            </label>
            <div class="ti-modal-footer mt-4 flex justify-end">
              <button *ngIf="(surveyDataServices.qualityAnalysisPostLoading$| async); else loadedContent" type="button"
                class="ti-btn ti-btn-primary-full ti-btn-loader ti-btn-disabled !py-1">
                <span class="me-2">Analysing..</span>
                <span class="loading"><i class="ri-refresh-line text-[1rem] animate-spin"></i></span>
              </button>
              <ng-template #loadedContent>
                <button class="ti-btn ti-btn-primary-full !py-1" (click)="onUpload()">Import</button>
              </ng-template>
            </div>
          </div>
        </div>
      </div>
      }
      }



    </div>
  </div>
</div>
